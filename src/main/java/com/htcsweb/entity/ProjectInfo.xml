<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.htcsweb.dao.ProjectInfoDao">


    <resultMap id="all" type="com.htcsweb.entity.ProjectInfo">
        <id property="id" column="id"></id>
        <result property="project_no" column="project_no"></result>
        <result property="project_name" column="project_name"></result>
        <result property="client_name" column="client_name"></result>
        <result property="client_spec" column="client_spec"></result>
        <result property="coating_standard" column="coating_standard"></result>
        <result property="mps" column="mps"></result>
        <result property="itp" column="itp"></result>
        <result property="project_time" column="project_time"></result>
        <result property="upload_files" column="upload_files"></result>
        <result property="od_coating_acceptance_criteria_no" column="od_coating_acceptance_criteria_no"></result>
        <result property="id_coating_acceptance_criteria_no" column="id_coating_acceptance_criteria_no"></result>
        <result property="lab_testing_acceptance_criteria_2fbe_no" column="lab_testing_acceptance_criteria_2fbe_no"></result>
        <result property="lab_testing_acceptance_criteria_3lpe_no" column="lab_testing_acceptance_criteria_3lpe_no"></result>
        <result property="raw_material_acceptance_criteria_2fbe_no" column="raw_material_acceptance_criteria_2fbe_no"></result>
        <result property="raw_material_acceptance_criteria_3lpe_no" column="raw_material_acceptance_criteria_3lpe_no"></result>
        <result property="pipe_body_acceptance_criteria_no" column="pipe_body_acceptance_criteria_no"></result>



    </resultMap>


    <select id="getCount" resultType="int">
        select count(*) from project_info
    </select>

    <select id="getCountAllByLike" resultType="int">
        select count(*) from project_info
        <where>
            <if test="project_no!=null and project_no!=''">
                project_no LIKE CONCAT('%',#{project_no},'%')
            </if>
            <if test="project_name!=null and project_name!=''">
                AND project_name LIKE CONCAT('%',#{project_name},'%')
            </if>
            <if test="client_name!=null and client_name!=''">
                AND client_name LIKE CONCAT('%',#{client_name},'%')
            </if>
            <if test="begin_time!=null">
                <![CDATA[ AND DATE_FORMAT(project_time,'%Y-%m-%d %H:%T:%s')>=DATE_FORMAT(#{begin_time},'%Y-%m-%d 00:00:00')]]>
            </if>
            <if test="end_time!=null">
                <![CDATA[ AND DATE_FORMAT(o.operation_time,'%Y-%m-%d %H:%T:%s')<DATE_FORMAT(DATE_ADD(#{end_time},INTERVAL 1 DAY),'%Y-%m-%d 00:00:00')]]>
            </if>
        </where>
    </select>


    <select id="hasProjectNo" resultType="int">
        select count(*) from project_info WHERE project_no=#{project_no}
    </select>


    <select id="getAllByLike" resultType="map">
        Select * from project_info
        <where>
            <if test="project_no!=null and project_no!=''">
                 project_no LIKE CONCAT('%',#{project_no},'%')
            </if>
            <if test="project_name!=null and project_name!=''">
                AND project_name LIKE CONCAT('%',#{project_name},'%')
            </if>
            <if test="client_name!=null and client_name!=''">
                AND client_name LIKE CONCAT('%',#{client_name},'%')
            </if>
            <if test="begin_time!=null">
                <![CDATA[ AND DATE_FORMAT(project_time,'%Y-%m-%d %H:%T:%s')>=DATE_FORMAT(#{begin_time},'%Y-%m-%d 00:00:00')]]>
            </if>
            <if test="end_time!=null">
                <![CDATA[ AND DATE_FORMAT(o.operation_time,'%Y-%m-%d %H:%T:%s')<DATE_FORMAT(DATE_ADD(#{end_time},INTERVAL 1 DAY),'%Y-%m-%d 00:00:00')]]>
            </if>

        </where>
        ORDER BY id DESC
        limit #{skip},#{take}
    </select>

    <update id="updateProjectInfo" parameterType="com.htcsweb.entity.ProjectInfo">
        UPDATE project_info set project_no=#{project_no},project_name=#{project_name},
        client_name=#{client_name},client_spec=#{client_spec},
        coating_standard=#{coating_standard},mps=#{mps},itp=#{itp} ,
        project_time=#{project_time},upload_files=#{upload_files},
        od_coating_acceptance_criteria_no=#{od_coating_acceptance_criteria_no},
        id_coating_acceptance_criteria_no=#{id_coating_acceptance_criteria_no} ,
        lab_testing_acceptance_criteria_2fbe_no=#{lab_testing_acceptance_criteria_2fbe_no},
        lab_testing_acceptance_criteria_3lpe_no=#{lab_testing_acceptance_criteria_3lpe_no},
        raw_material_acceptance_criteria_2fbe_no=#{raw_material_acceptance_criteria_2fbe_no},
        raw_material_acceptance_criteria_3lpe_no=#{raw_material_acceptance_criteria_3lpe_no},
        pipe_body_acceptance_criteria_no=#{pipe_body_acceptance_criteria_no}
         WHERE id=#{id}
    </update>

    <insert id="addProjectInfo" parameterType="com.htcsweb.entity.ProjectInfo">
        INSERT INTO project_info(project_no,project_name,client_name,client_spec,coating_standard,mps,itp,project_time,upload_files,od_coating_acceptance_criteria_no,id_coating_acceptance_criteria_no,lab_testing_acceptance_criteria_2fbe_no,lab_testing_acceptance_criteria_3lpe_no,raw_material_acceptance_criteria_2fbe_no,raw_material_acceptance_criteria_3lpe_no,pipe_body_acceptance_criteria_no)
         VALUES (#{project_no},#{project_name},#{client_name},#{client_spec},#{coating_standard},#{mps},#{itp},#{project_time},#{upload_files},#{od_coating_acceptance_criteria_no},#{id_coating_acceptance_criteria_no},#{lab_testing_acceptance_criteria_2fbe_no},#{lab_testing_acceptance_criteria_3lpe_no},#{raw_material_acceptance_criteria_2fbe_no},#{raw_material_acceptance_criteria_3lpe_no},#{pipe_body_acceptance_criteria_no})
    </insert>

    <delete id="delProjectInfo">
        delete from project_info WHERE
        <foreach collection="array" item="item" open="id in (" separator="," close=")">
            #{item}
        </foreach>
    </delete>

    <select id="getProjectInfo" resultType="com.htcsweb.entity.ProjectInfo">
        SELECT * from project_info
        <where>
            <if test="project_no!=null and project_no!=''">
                AND project_no LIKE CONCAT('%',#{project_no},'%')
            </if>
        </where>
    </select>
    <select id="getProjectNameByNo" resultType="java.lang.String">
        SELECT project_name from project_info WHERE project_no=#{project_no}
    </select>
    
    <select id="getProjectInfoByContract" resultType="com.htcsweb.entity.ProjectInfo">
        SELECT p.* from project_info  p inner JOIN contract_info c on c.project_no=p.project_no where c.contract_no=#{contract_no}
    </select>
    
    <select id="getProjectInfoByID" resultType="com.htcsweb.entity.ProjectInfo">
        SELECT * from project_info WHERE id=#{id}
    </select>

    <select id="getProjectInfoByNoOrName" resultType="map">
            Select * from project_info p
            <where>
                <if test="project_no!=null and project_no!=''">
                 AND project_no LIKE CONCAT('%',#{project_no},'%')
                </if>
                <if test="project_name!=null and project_name!=''">
                    AND project_name LIKE CONCAT('%',#{project_name},'%')
                </if>
            </where>
    </select>

    <select id="getProjectNoAndName" resultType="map">
        SELECT p.project_no,p.project_name FROM  project_info p
    </select>
    <!--根据项目编号获取项目信息-->
    <select id="getProjectInfoByProjectNo" resultType="com.htcsweb.entity.ProjectInfo">
        SELECT * FROM project_info WHERE project_no=#{project_no}
    </select>
</mapper>